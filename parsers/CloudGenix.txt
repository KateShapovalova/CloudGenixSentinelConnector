// Usage Instructions:
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name as CloudGenix and specifying Legacy Category.
// This function maps CloudGenix events to Azure Sentinel Information Model (ASIM) (https://docs.microsoft.com/azure/sentinel/normalization).
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. CloudGenix | take 10).
// Reference : Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
CloudGenix_CL
| extend EventVendor = 'Palo Alto Networks',
         EventProduct = 'CloudGenix',
         EventCount = 1,
         CreatedAt = _created_on_utc_d
| extend EventOriginalUid = id_s,
        Schema = _schema_d,
        Etag = _etag_d,
        EventEndTime = _updated_on_utc_d,
        ErrorCode = tostring(parse_json(response_body_s)._error[0].code),
        WarningCode = tostring(parse_json(response_body_s)._warning[0].code),
        ErrorMessage = tostring(parse_json(response_body_s)._error[0].message),
        WarningMessage = tostring(parse_json(response_body_s)._warning[0].message),
        TenantId = tenant_id_s,
        OperatorId = operator_id_s,
        OperatorTenantId = operator_tenant_id_s,
        SessionKey = session_key_c_s,
        RequestId = request_id_s,
        IpAddr = source_ip_s,
        ResponseBody = response_body_s,
        ResourseKey = resource_key_s,
        ResourseId = resource_id_s,
        ResourseEtag = resource_etag_d,
        ResourseVersion = resource_version_s,
        EventType = request_type_s,
        RequestUri = request_uri_s,
        RequestBody = request_body_s,
        ResponseCode = response_code_d,
        TimeOfProcessing = time_ms_d,
        RequestContentLength = request_content_length_d,
        ResponseContentLength = response_content_length_d,
        RequestTimestamp = request_ts_d,
        ResponseTimestamp = response_ts_d
|project-away   id_s,
        _schema_d,
        _etag_d,
        _updated_on_utc_d,
        tenant_id_s,
        operator_id_s,
        operator_tenant_id_s,
        session_key_c_s,
        request_id_s,
        source_ip_s,
        resource_key_s,
        resource_id_s,
        resource_etag_d,
        resource_version_s,
        request_type_s,
        request_uri_s,
        request_body_s,
        response_code_d,
        response_body_s,
        time_ms_d,
        request_content_length_d,
        response_content_length_d,
        request_ts_d,
        response_ts_d,
        _created_on_utc_d
